---
import BaseHead from '../components/BaseHead.astro';
import { Image } from 'astro:assets';
import logoImg from '../assets/images/logo-main.png';
import '../styles/global.css';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import LanguagePicker from '../components/LanguagePicker.astro';

interface Props {
	title: string;
	description: string;
}

const { title, description } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Helper for nav links to prepend lang if not default
const localizePath = (path: string) => {
    if (lang === 'es') return path;
    // ensure path starts with /
    const p = path.startsWith('/') ? path : `/${path}`;
    return `/${lang}${p}`;
};
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
	<head>
		<BaseHead title={title} description={description} />
	</head>
	<body class="bg-stone-50 text-stone-800 font-sans antialiased min-h-screen flex flex-col">
		<header class="bg-stone-100/90 backdrop-blur-sm border-b border-stone-200 sticky top-0 z-50 transition-all duration-300">
			<div class="container mx-auto px-4 h-24 flex items-center justify-between relative">
				<!-- Mobile Menu Button (Left) -->
				<button id="menu-toggle" class="min-[1285px]:hidden p-2 text-stone-600 hover:text-clay-dark focus:outline-none z-20" aria-label="Abrir menÃº">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
					</svg>
				</button>
                
                <!-- Mobile Language (visible only on mobile/tablet, absolutely positioned right) -->
                <div class="min-[1285px]:hidden absolute right-4 top-1/2 -translate-y-1/2 z-20">
                     <LanguagePicker />
                </div>

				<!-- Logo (Center) -->
				<a href={localizePath('/')} class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center gap-3 group z-10 w-fit">
					<Image 
						src={logoImg} 
						alt="Anthropos Logo" 
						class="h-16 w-auto group-hover:opacity-90 transition-opacity" 
						loading="eager"
						height={128}
						format="webp"
					/>
				</a>

				<div class="flex-1 hidden min-[1285px]:flex justify-end gap-6 items-center">
					<nav class="flex gap-8 items-center">
						<a href={localizePath('/')} class="text-stone-600 hover:text-clay-dark font-medium transition-colors text-lg">{t('nav.home')}</a>
						<a href={localizePath('/proyectos')} class="text-stone-600 hover:text-clay-dark font-medium transition-colors text-lg">{t('nav.projects')}</a>
						<a href={localizePath('/blog')} class="text-stone-600 hover:text-clay-dark font-medium transition-colors text-lg">{t('nav.blog')}</a>
						<a href={localizePath('/contacto')} class="text-stone-600 hover:text-clay-dark font-medium transition-colors text-lg">{t('nav.contact')}</a>
					</nav>
                    <LanguagePicker />
				</div>
			</div>

			<!-- Mobile Menu Panel -->
			<div id="mobile-menu" class="hidden min-[1285px]:hidden bg-stone-100 border-t border-stone-200 absolute w-full left-0 top-24 z-40">
				<nav class="flex flex-col p-4 gap-4 text-center">
					<a href={localizePath('/')} class="text-stone-600 hover:text-clay-dark font-medium py-2 text-lg">{t('nav.home')}</a>
					<a href={localizePath('/proyectos')} class="text-stone-600 hover:text-clay-dark font-medium py-2 text-lg">{t('nav.projects')}</a>
					<a href={localizePath('/blog')} class="text-stone-600 hover:text-clay-dark font-medium py-2 text-lg">{t('nav.blog')}</a>
					<a href={localizePath('/contacto')} class="text-stone-600 hover:text-clay-dark font-medium py-2 text-lg">{t('nav.contact')}</a>
				</nav>
			</div>
		</header>

		<main class="flex-grow container mx-auto px-4 py-8 md:py-12">
			<slot />
		</main>

		<footer class="bg-stone-900 text-stone-400 py-12 mt-auto">
			<div class="container mx-auto px-4 grid md:grid-cols-3 gap-8">
				<div>
					<h3 class="text-stone-200 font-serif font-bold text-xl mb-4">ANTHROPOS</h3>
					<p class="text-sm leading-relaxed">
						{t('footer.desc')}
					</p>
				</div>
				<div>
					<h4 class="text-stone-200 font-bold mb-4">{t('footer.services')}</h4> <!-- Simplified for now -->
					<ul class="space-y-2 text-sm">
						<li><a href="#" class="hover:text-stone-200 transition-colors">{t('footer.about')}</a></li>
						<li><a href="#" class="hover:text-stone-200 transition-colors">{t('footer.services')}</a></li>
						<li><a href="#" class="hover:text-stone-200 transition-colors">{t('footer.privacy')}</a></li>
					</ul>
				</div>
				<div>
					<h4 class="text-stone-200 font-bold mb-4">{t('nav.contact')}</h4>
					<p class="text-sm">info@anthropos-arch.com</p>
					<div class="flex gap-4 mt-4">
						<!-- Social Icons placeholders -->
						<div class="w-8 h-8 bg-stone-800 rounded-full"></div>
						<div class="w-8 h-8 bg-stone-800 rounded-full"></div>
						<div class="w-8 h-8 bg-stone-800 rounded-full"></div>
					</div>
				</div>
			</div>
			<div class="container mx-auto px-4 mt-8 pt-8 border-t border-stone-800 text-center text-xs">
				&copy; {new Date().getFullYear()} Anthropos Archaeology. {t('footer.rights')}
			</div>
		</footer>

		<script>
			// Mobile Menu Logic
			const menuToggle = document.getElementById('menu-toggle');
			const mobileMenu = document.getElementById('mobile-menu');

			if (menuToggle && mobileMenu) {
				menuToggle.addEventListener('click', () => {
					mobileMenu.classList.toggle('hidden');
				});
			}
		</script>
	</body>
</html>
